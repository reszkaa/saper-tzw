<!DOCTYPE html>
<html lang="pl">
<head>
    <!-- Podstawowe ustawienia strony -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="1-fc042bca.ico">
    <title>Saper | Gra logiczna</title>
    
    <!-- adujemy fajne czcionki z internetu -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* Tutaj s kolory dla normalnego trybu (jasnego) */
        :root {
            --primary-color: #4a6fa5;       /* Niebieski kolor guzik贸w */
            --secondary-color: #166088;     /* Ciemniejszy niebieski */
            --accent-color: #4fc3f7;        /* Jasny niebieski */
            --text-color: #333;             /* Kolor tekstu - prawie czarny */
            --bg-color: #f5f5f5;           /* Kolor ta strony */
            --panel-bg: #e8e8e8;            /* Kolor panelu gry */
            --border-color: #ccc;           /* Kolor obramowa */
            --success-color: #4caf50;       /* Zielony kolor sukcesu */
            --danger-color: #f44336;        /* Czerwony kolor przegranej */
            --warning-color: #ff9800;       /* Pomaraczowy kolor ostrze偶enia */
            --flag-color: #ffeb3b;          /* 呕贸ty kolor flagi */
            --mine-color: #d32f2f;          /* Czerwony kolor miny */
        }

        /* Kolory dla ciemnego trybu */
        .dark-mode {
            --primary-color: #3a5683;
            --secondary-color: #0d4b6e;
            --accent-color: #0288d1;
            --text-color: #e0e0e0;          /* Jasny tekst */
            --bg-color: #121212;            /* Ciemne to */
            --panel-bg: #1e1e1e;            /* Ciemny panel */
            --border-color: #444;            /* Ciemna ramka */
            --success-color: #81c784;        /* Jasna ziele */
            --danger-color: #e57373;         /* Jasna czerwie */
            --warning-color: #ffb74d;        /* Jasny pomaracz */
            --flag-color: #fff176;           /* Jasna 偶贸 */
            --mine-color: #f44336;           /* Czerwony */
        }

        /* Ustawienia caej strony */
        body {
            font-family: 'Roboto', sans-serif;  /* Czcionka tekstu */
            text-align: center;                /* Wszystko na rodku */
            margin: 0;                         /* Bez margines贸w */
            padding: 20px;                     /* Troch odstpu */
            background-color: var(--bg-color);  /* Kolor ta */
            color: var(--text-color);          /* Kolor tekstu */
            transition: all 0.3s ease;         /* Animacja zmiany kolor贸w */
        }

        /* Nag贸wek gry */
        h1 {
            font-family: 'Press Start 2P', cursive; /* Retro czcionka */
            color: var(--primary-color);       /* Kolor tekstu */
            margin-bottom: 20px;               /* Odstp od dou */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* Cie tekstu */
            font-size: 2.2rem;                /* Du偶y rozmiar */
        }

        /* G贸wny panel gry */
        .panel-gry {
            margin: 20px auto;                 /* Marginesy */
            padding: 20px;                     /* Odstp wewntrz */
            background: var(--panel-bg);       /* Kolor ta */
            width: fit-content;               /* Szeroko dopasowana */
            border-radius: 10px;               /* Zaokrglone rogi */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Cie */
            border: 1px solid var(--border-color); /* Obramowanie */
            max-width: 90%;                   /* Maksymalna szeroko */
        }

        /* Plansza do gry */
        .plansza {
            display: inline-grid;              /* Siatka p贸l */
            grid-gap: 2px;                     /* Odstp midzy polami */
            background: var(--border-color);   /* Kolor ta */
            border-radius: 5px;                /* Zaokrglone rogi */
            margin: 20px auto;                 /* Marginesy */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Cie */
        }

        /* Pojedyncze pole na planszy */
        .pole {
            width: 30px;                       /* Szeroko pola */
            height: 30px;                      /* Wysoko pola */
            background: var(--panel-bg);       /* Kolor ta */
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku w poziomie */
            align-items: center;               /* Na rodku w pionie */
            font-weight: bold;                 /* Pogrubiony tekst */
            cursor: pointer;                   /* Kursor wskazujcy */
            border-radius: 3px;                /* Lekko zaokrglone rogi */
            transition: all 0.2s ease;         /* Animacja */
            font-size: 14px;                   /* Rozmiar czcionki */
            user-select: none;                 /* Nie mo偶na zaznaczy */
        }

        /* Efekt po najechaniu na pole */
        .pole:hover {
            background: #d0d0d0;               /* Jasnoszare to */
        }

        /* Efekt hover w ciemnym trybie */
        .dark-mode .pole:hover {
            background: #333;                  /* Ciemne to */
        }

        /* Odkryte pole */
        .odkryte {
            background: var(--bg-color);       /* Kolor ta */
        }

        /* Pole z min */
        .mina {
            background: var(--mine-color);     /* Czerwone to */
            color: white;                      /* Biay tekst */
        }

        /* Pole z flag */
        .flaga {
            background: var(--flag-color);     /* 呕贸te to */
            color: #000;                       /* Czarny tekst */
        }

        /* Kontener z przyciskami */
        .przyciski {
            margin: 20px;                      /* Marginesy */
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku */
            gap: 15px;                         /* Odstp midzy przyciskami */
            flex-wrap: wrap;                   /* Zawijanie przycisk贸w */
        }

        /* Style przycisk贸w */
        button {
            padding: 10px 20px;                /* Odstp wewntrz */
            background-color: var(--primary-color); /* Kolor ta */
            color: white;                      /* Biay tekst */
            border: none;                      /* Bez obramowania */
            border-radius: 5px;                /* Zaokrglone rogi */
            cursor: pointer;                   /* Kursor wskazujcy */
            font-size: 16px;                   /* Rozmiar czcionki */
            transition: all 0.2s ease;         /* Animacja */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Cie */
        }

        /* Efekt po najechaniu na przycisk */
        button:hover {
            background-color: var(--secondary-color); /* Ciemniejsze to */
            transform: translateY(-2px);       /* Uniesienie przycisku */
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Wikszy cie */
        }

        /* Efekt kliknicia przycisku */
        button:active {
            transform: translateY(0);          /* Powr贸t do normalnej pozycji */
        }

        /* Kontener ze statystykami */
        .statystyki {
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku */
            gap: 20px;                         /* Odstp midzy elementami */
            margin-bottom: 15px;               /* Margines od dou */
            font-size: 18px;                   /* Rozmiar czcionki */
            flex-wrap: wrap;                   /* Zawijanie element贸w */
        }

        /* Pojedyncza statystyka */
        .statystyka {
            background: rgba(0,0,0,0.1);       /* P贸przezroczyste to */
            padding: 8px 15px;                 /* Odstp wewntrz */
            border-radius: 20px;               /* Bardzo zaokrglone rogi */
            display: flex;                     /* Flexbox */
            align-items: center;               /* Na rodku w pionie */
            gap: 5px;                          /* Odstp midzy elementami */
        }

        /* Statystyki w ciemnym trybie */
        .dark-mode .statystyka {
            background: rgba(255,255,255,0.1); /* Jasne p贸przezroczyste to */
        }

        /* Kontener z opcjami */
        .opcje {
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku */
            gap: 20px;                         /* Odstp midzy opcjami */
            margin-top: 15px;                  /* Margines od g贸ry */
            flex-wrap: wrap;                   /* Zawijanie element贸w */
        }

        /* Opcja jako checkbox */
        .checkbox-opcja {
            display: flex;                     /* Flexbox */
            align-items: center;               /* Na rodku w pionie */
            gap: 8px;                          /* Odstp midzy elementami */
            cursor: pointer;                   /* Kursor wskazujcy */
            font-family: 'Press Start 2P', cursive; /* Retro czcionka */
            color: var(--primary-color);       /* Kolor tekstu */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* Cie tekstu */
        }

        /* Sam checkbox */
        .checkbox-opcja input {
            width: 18px;                       /* Szeroko */
            height: 18px;                      /* Wysoko */
            cursor: pointer;                   /* Kursor wskazujcy */
        }

        /* Wyb贸r poziomu trudnoci */
        .wybor-poziomu {
            margin-bottom: 20px;               /* Margines od dou */
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku */
            gap: 10px;                         /* Odstp midzy przyciskami */
            align-items: center;               /* Na rodku w pionie */
            flex-wrap: wrap;                   /* Zawijanie przycisk贸w */
        }

        /* Przycisk wyboru poziomu */
        .przycisk-poziomu {
            background-color: var(--panel-bg); /* Kolor ta */
            border: 2px solid var(--border-color); /* Obramowanie */
            border-radius: 20px;               /* Bardzo zaokrglone rogi */
            padding: 8px 16px;                 /* Odstp wewntrz */
            font-size: 14px;                   /* Rozmiar czcionki */
            cursor: pointer;                   /* Kursor wskazujcy */
            transition: all 0.2s ease;         /* Animacja */
            display: flex;                     /* Flexbox */
            align-items: center;               /* Na rodku w pionie */
            gap: 8px;                          /* Odstp midzy elementami */
        }

        /* Efekt po najechaniu na przycisk poziomu */
        .przycisk-poziomu:hover {
            background-color: var(--accent-color); /* Kolor akcentu */
            color: white;                      /* Biay tekst */
            border-color: var(--accent-color); /* Kolor obramowania */
            transform: scale(1.05);            /* Lekkie powikszenie */
        }

        /* Aktywny przycisk poziomu */
        .przycisk-poziomu.aktywny {
            background-color: var(--success-color); /* Zielone to */
            color: white;                      /* Biay tekst */
            border-color: var(--success-color); /* Zielone obramowanie */
        }

        /* Ostrze偶enie o czasie */
        .czas-ostrzeganie {
            color: var(--warning-color);       /* Pomaraczowy kolor */
            font-weight: bold;                 /* Pogrubienie */
        }
        
        /* Krytyczny czas */
        .czas-krytyczny {
            color: var(--danger-color);        /* Czerwony kolor */
            font-weight: bold;                 /* Pogrubienie */
            animation: pulse 0.5s infinite alternate; /* Animacja pulsowania */
        }
        
        /* Animacja pulsowania */
        @keyframes pulse {
            from { opacity: 1; }               /* Pena widoczno */
            to { opacity: 0.7; }               /* Mniejsza widoczno */
        }

        /* Okno modalne (wynik gry) */
        .modal {
            display: none;                     /* Na pocztku ukryte */
            position: fixed;                   /* Staa pozycja */
            top: 0;                           /* Od g贸ry */
            left: 0;                          /* Od lewej */
            width: 100%;                      /* Caa szeroko */
            height: 100%;                      /* Caa wysoko */
            background-color: rgba(0,0,0,0.7); /* P贸przezroczyste to */
            z-index: 100;                      /* Na wierzchu */
            justify-content: center;           /* Na rodku w poziomie */
            align-items: center;               /* Na rodku w pionie */
        }

        /* Zawarto modala */
        .modal-content {
            background-color: var(--panel-bg); /* Kolor ta */
            padding: 30px;                     /* Odstp wewntrz */
            border-radius: 10px;               /* Zaokrglone rogi */
            max-width: 400px;                  /* Maksymalna szeroko */
            width: 90%;                        /* Procentowa szeroko */
            text-align: center;                /* Tekst na rodku */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Cie */
            animation: modalFadeIn 0.3s ease;  /* Animacja pojawiania */
        }

        /* Animacja pojawiania si modala */
        @keyframes modalFadeIn {
            from { 
                opacity: 0;                    /* Niewidoczny */
                transform: translateY(-20px);  /* Przesunity do g贸ry */
            }
            to { 
                opacity: 1;                    /* Widoczny */
                transform: translateY(0);      /* Normalna pozycja */
            }
        }

        /* Nag贸wek modala */
        .modal h2 {
            margin-top: 0;                     /* Brak marginesu od g贸ry */
            color: var(--primary-color);       /* Kolor tekstu */
            font-size: 24px;                   /* Rozmiar czcionki */
        }

        /* Tekst w modalu */
        .modal p {
            font-size: 18px;                   /* Rozmiar czcionki */
            margin-bottom: 25px;               /* Margines od dou */
        }

        /* Przyciski w modalu */
        .modal-buttons {
            display: flex;                     /* Flexbox */
            justify-content: center;           /* Na rodku */
            gap: 15px;                         /* Odstp midzy przyciskami */
        }

        /* Przycisk w modalu */
        .modal-btn {
            padding: 10px 20px;                /* Odstp wewntrz */
            border-radius: 5px;                /* Zaokrglone rogi */
            font-weight: bold;                 /* Pogrubienie */
            cursor: pointer;                   /* Kursor wskazujcy */
            transition: all 0.2s ease;         /* Animacja */
        }

        /* G贸wny przycisk w modalu */
        .modal-btn-primary {
            background-color: var(--primary-color); /* Kolor ta */
            color: white;                      /* Biay tekst */
            border: none;                      /* Bez obramowania */
        }

        /* Efekt po najechaniu na g贸wny przycisk */
        .modal-btn-primary:hover {
            background-color: var(--secondary-color); /* Ciemniejsze to */
        }

        /* Drugi przycisk w modalu */
        .modal-btn-secondary {
            background-color: transparent;     /* Przezroczyste to */
            border: 2px solid var(--border-color); /* Obramowanie */
            color: var(--text-color);         /* Kolor tekstu */
        }

        /* Efekt po najechaniu na drugi przycisk */
        .modal-btn-secondary:hover {
            border-color: var(--primary-color); /* Kolor obramowania */
        }

        /* Emotka wyniku */
        .emoji-wynik {
            font-size: 50px;                   /* Du偶y rozmiar */
            margin-bottom: 15px;               /* Margines od dou */
            display: block;                    /* Element blokowy */
        }

        /* Klasa dla wygranej */
        .win {
            color: var(--success-color);       /* Zielony kolor */
        }

        /* Klasa dla przegranej */
        .lose {
            color: var(--danger-color);        /* Czerwony kolor */
        }

        /* Kolory dla liczb na polach (1-8) */
        .liczba-1 { color: #1976d2; }          /* Niebieski */
        .liczba-2 { color: #388e3c; }         /* Zielony */
        .liczba-3 { color: #d32f2f; }         /* Czerwony */
        .liczba-4 { color: #7b1fa2; }         /* Fioletowy */
        .liczba-5 { color: #ff8f00; }         /* Pomaraczowy */
        .liczba-6 { color: #0097a7; }         /* Turkusowy */
        .liczba-7 { color: #5d4037; }         /* Brzowy */
        .liczba-8 { color: #455a64; }         /* Szaroniebieski */

        /* Ukryty select do wyboru poziomu */
        #poziom {
            position: absolute;                /* Absolutna pozycja */
            opacity: 0;                        /* Niewidoczny */
            height: 0;                         /* Brak wysokoci */
            width: 0;                          /* Brak szerokoci */
            overflow: hidden;                  /* Ukrycie zawartoci */
            pointer-events: none;              /* Brak interakcji */
        }

        /* Style dla limitu flag */
        .limit-flag {
            color: var(--danger-color);        /* Czerwony kolor */
            font-weight: bold;                 /* Pogrubienie */
        }

        .programisci{
            font-family: 'Press Start 2P', cursive; /*czcionka*/
             color: var(--primary-color);       /* Kolor tekstu */
             text-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* Cie tekstu */
        }
    </style>
</head>
<!-- Blokada menu kontekstowego (prawy przycisk myszy) -->
<body oncontextmenu="return false;">
    <h1>SAPER</h1>

    <!-- G贸wny panel gry -->
    <div class="panel-gry">
        <!-- Wyb贸r poziomu trudnoci -->
        <div class="wybor-poziomu">
            <span>Poziom trudnoci:</span>
            <button data-poziom="latwy" class="przycisk-poziomu"> atwy</button>
            <button data-poziom="sredni" class="przycisk-poziomu aktywny"> redni</button>
            <button data-poziom="trudny" class="przycisk-poziomu"> Trudny</button>
        </div>

        <!-- Ukryty select do przechowywania wybranego poziomu -->
        <select id="poziom">
            <option value="latwy">atwy (10x10, 20 min)</option>
            <option value="sredni" selected>redni (15x15, 30 min)</option>
            <option value="trudny">Trudny (20x20, 60 min)</option>
        </select>

        <!-- Statystyki gry -->
        <div class="statystyki">
            <div class="statystyka"> <span id="liczba-min">0</span></div>
            <div class="statystyka"> <span id="liczba-flag">0</span>/<span id="limit-flag">0</span></div>
            <div class="statystyka">憋 <span id="czas">0</span>s <span id="limit-czasu"></span></div>
        </div>

        <!-- Opcje dodatkowe -->
        <div class="opcje">
            <label class="checkbox-opcja">
                <input type="checkbox" id="tryb-ciemny"> Tryb ciemny
            </label>
            <label class="checkbox-opcja">
                <input type="checkbox" id="tryb-na-czas"> Tryb na czas
            </label>
        </div>
    </div>

    <!-- Plansza gry -->
    <div class="plansza" id="plansza"></div>

    <!-- Przyciski sterujce -->
    <div class="przyciski">
        <button id="nowa-gra"> Nowa gra</button>
    </div>

    <!-- Modal z wynikiem gry -->
    <div class="modal" id="modal-wynik">
        <div class="modal-content">
            <span class="emoji-wynik" id="emoji-wynik"></span>
            <h2 id="tytul-wynik"></h2>
            <p id="tresc-wynik"></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="nowa-gra-modal">Nowa gra</button>
                <button class="modal-btn modal-btn-secondary" id="zamknij-modal">Zamknij</button>
            </div>
        </div>
    </div>

    <script>
        // Ustawienia gry dla r贸偶nych poziom贸w trudnoci
        const ustawienia = {
            latwy: { rozmiar: 10, miny: 20, limitCzasu: 180 },    // atwy poziom
            sredni: { rozmiar: 15, miny: 30, limitCzasu: 300 },   // redni poziom
            trudny: { rozmiar: 20, miny: 60, limitCzasu: 480 }     // Trudny poziom
        };

        // Zmienne do przechowywania stanu gry
        let rozmiarPlanszy = 15;      // Rozmiar planszy (15x15)
        let liczbaMin = 30;           // Liczba min na planszy
        let limitFlag = 60;           // Maksymalna liczba flag
        let plansza = [];             // Tablica reprezentujca plansz
        let odkrytePola = 0;          // Liczba odkrytych p贸l
        let koniecGry = false;        // Czy gra si skoczya
        let liczbaFlag = 0;           // Liczba postawionych flag
        let czas = 0;                 // Czas gry w sekundach
        let timer;                    // Timer do liczenia czasu
        let pierwszeKlikniecie = true;// Czy to pierwsze kliknicie w grze
        let trybNaCzas = false;       // Czy wczony jest tryb na czas
        let limitCzasu = 300;         // Limit czasu dla trybu na czas

        // Pobieramy elementy z HTML
        const elementPlanszy = document.getElementById('plansza');
        const elementLiczbaMin = document.getElementById('liczba-min');
        const elementLiczbaFlag = document.getElementById('liczba-flag');
        const elementLimitFlag = document.getElementById('limit-flag');
        const elementCzas = document.getElementById('czas');
        const elementLimitCzasu = document.getElementById('limit-czasu');
        const elementNowaGra = document.getElementById('nowa-gra');
        const elementNowaGraModal = document.getElementById('nowa-gra-modal');
        const elementPoziom = document.getElementById('poziom');
        const przecznikTrybu = document.getElementById('tryb-ciemny');
        const przecznikTrybuCzasu = document.getElementById('tryb-na-czas');
        const modalWynik = document.getElementById('modal-wynik');
        const emojiWynik = document.getElementById('emoji-wynik');
        const tytulWynik = document.getElementById('tytul-wynik');
        const trescWynik = document.getElementById('tresc-wynik');
        const zamknijModal = document.getElementById('zamknij-modal');

        // Ustawiamy obsug przycisk贸w poziomu trudnoci
        const przyciskiPoziomu = document.querySelectorAll('.przycisk-poziomu');
        przyciskiPoziomu.forEach(przycisk => {
            przycisk.addEventListener('click', () => {
                // Usuwamy klas aktywn ze wszystkich przycisk贸w
                przyciskiPoziomu.forEach(p => p.classList.remove('aktywny'));
                // Dodajemy klas aktywn do kliknitego przycisku
                przycisk.classList.add('aktywny');
                // Pobieramy wybrany poziom
                const wybrany = przycisk.dataset.poziom;
                // Ustawiamy warto ukrytego selecta
                elementPoziom.value = wybrany;
                // Rozpoczynamy now gr
                rozpocznijGre();
            });
        });

        // Obsuga przycisku nowej gry
        elementNowaGra.addEventListener('click', rozpocznijGre);
        
        // Obsuga przycisku nowej gry w modalu
        elementNowaGraModal.addEventListener('click', () => {
            modalWynik.style.display = 'none'; // Chowamy modal
            rozpocznijGre();                  // Nowa gra
        });
        
        // Obsuga przycisku zamknicia modala
        zamknijModal.addEventListener('click', () => {
            modalWynik.style.display = 'none'; // Chowamy modal
        });
        
        // Obsuga przecznika trybu ciemnego
        przecznikTrybu.addEventListener('change', () => {
            // Wczamy/wyczamy ciemny tryb
            document.body.classList.toggle('dark-mode', przecznikTrybu.checked);
        });
        
        // Obsuga przecznika trybu na czas
        przecznikTrybuCzasu.addEventListener('change', () => {
            trybNaCzas = przecznikTrybuCzasu.checked; // Ustawiamy flag
            rozpocznijGre();                           // Nowa gra
        });

        // Rozpoczynamy pierwsz gr po zaadowaniu strony
        rozpocznijGre();

        /**
         * Funkcja rozpoczynajca now gr
         */
        function rozpocznijGre() {
            // Zatrzymujemy timer jeli dziaa
            clearInterval(timer);
            
            // Resetujemy czas
            czas = 0;
            elementCzas.textContent = czas;
            elementLimitCzasu.textContent = '';
            elementCzas.className = '';
            elementLimitCzasu.className = '';

            // Pobieramy ustawienia dla wybranego poziomu
            const poziom = elementPoziom.value;
            rozmiarPlanszy = ustawienia[poziom].rozmiar;
            liczbaMin = ustawienia[poziom].miny;
            limitFlag = liczbaMin * 2; // Limit flag to 2x liczba min
            limitCzasu = ustawienia[poziom].limitCzasu;

            // Resetujemy stan gry
            plansza = [];
            odkrytePola = 0;
            koniecGry = false;
            liczbaFlag = 0;
            pierwszeKlikniecie = true;

            // Czycimy plansz
            elementPlanszy.innerHTML = '';
            elementPlanszy.style.gridTemplateColumns = `repeat(${rozmiarPlanszy}, 30px)`;

            // Aktualizujemy statystyki
            elementLiczbaMin.textContent = liczbaMin;
            elementLiczbaFlag.textContent = liczbaFlag;
            elementLimitFlag.textContent = limitFlag;

            // Tworzymy plansz jako tablic dwuwymiarow
            for (let y = 0; y < rozmiarPlanszy; y++) {
                plansza[y] = [];
                for (let x = 0; x < rozmiarPlanszy; x++) {
                    // Inicjalizujemy ka偶de pole
                    plansza[y][x] = {
                        czyMina: false,     // Czy jest mina
                        czyOdkryte: false,  // Czy odkryte
                        czyFlaga: false,    // Czy flaga
                        minyObok: 0         // Liczba min obok
                    };

                    // Tworzymy element div dla pola
                    const poleDiv = document.createElement('div');
                    poleDiv.className = 'pole';
                    poleDiv.dataset.wiersz = y;
                    poleDiv.dataset.kolumna = x;

                    // Dodajemy obsug kliknicia lewym przyciskiem
                    poleDiv.addEventListener('click', () => klikPole(x, y));
                    
                    // Dodajemy obsug prawego przycisku (flaga)
                    poleDiv.addEventListener('contextmenu', (e) => {
                        e.preventDefault(); // Blokujemy menu kontekstowe
                        prawyKlik(x, y);    // Wywoujemy funkcj
                    });

                    // Dodajemy pole do planszy
                    elementPlanszy.appendChild(poleDiv);
                }
            }
        }

        /**
         * Rozmieszcza miny na planszy, omijajc obszar wok贸 pierwszego kliknicia
         * @param {number} pierwszeX - Kolumna pierwszego kliknicia
         * @param {number} pierwszeY - Wiersz pierwszego kliknicia
         */
        function rozmiescMiny(pierwszeX, pierwszeY) {
            // Okrelamy bezpieczn stref wok贸 pierwszego kliknicia
            const bezpiecznaStrefa = pobierzBezpiecznaStrefe(pierwszeX, pierwszeY);
            let rozmieszczoneMiny = 0;

            // Rozmieszczamy miny losowo
            while (rozmieszczoneMiny < liczbaMin) {
                // Losowe wsp贸rzdne
                const x = Math.floor(Math.random() * rozmiarPlanszy);
                const y = Math.floor(Math.random() * rozmiarPlanszy);

                // Sprawdzamy czy mo偶na postawi min
                if (!plansza[y][x].czyMina && !bezpiecznaStrefa.has(`${x},${y}`)) {
                    plansza[y][x].czyMina = true;
                    rozmieszczoneMiny++;
                }
            }

            // Liczymy miny obok ka偶dego pola
            policzMinyObok();
        }

        /**
         * Zwraca bezpieczn stref wok贸 danego pola (bez min)
         * @param {number} x - Kolumna rodkowego pola
         * @param {number} y - Wiersz rodkowego pola
         * @returns {Set} Zbi贸r wsp贸rzdnych p贸l w strefie
         */
        function pobierzBezpiecznaStrefe(x, y) {
            const strefa = new Set();
            // Wszystkie kierunki ssiedztwa (8 kierunk贸w + rodek)
            const kierunki = [
                [-1,-1], [-1,0], [-1,1],
                [0,-1],  [0,0],  [0,1],
                [1,-1],  [1,0],  [1,1]
            ];

            // Dodajemy wszystkie pola w ssiedztwie do strefy
            for (const [dx, dy] of kierunki) {
                const nx = x + dx;
                const ny = y + dy;
                // Sprawdzamy czy wsp贸rzdne s na planszy
                if (nx >= 0 && nx < rozmiarPlanszy && ny >= 0 && ny < rozmiarPlanszy) {
                    strefa.add(`${nx},${ny}`);
                }
            }

            return strefa;
        }

        /**
         * Liczy dla ka偶dego pola liczb min w ssiedztwie
         */
        function policzMinyObok() {
            // Wszystkie kierunki ssiedztwa (8 kierunk贸w)
            const kierunki = [
                [-1,-1], [-1,0], [-1,1],
                [0,-1],          [0,1],
                [1,-1],  [1,0],  [1,1]
            ];

            // Przechodzimy przez wszystkie pola planszy
            for (let y = 0; y < rozmiarPlanszy; y++) {
                for (let x = 0; x < rozmiarPlanszy; x++) {
                    // Pomijamy pola z minami
                    if (plansza[y][x].czyMina) continue;

                    let licznik = 0;
                    // Sprawdzamy wszystkich ssiad贸w
                    for (const [dx, dy] of kierunki) {
                        const nx = x + dx;
                        const ny = y + dy;
                        // Sprawdzamy czy ssiad jest na planszy i ma min
                        if (nx >= 0 && nx < rozmiarPlanszy && ny >= 0 && ny < rozmiarPlanszy && plansza[ny][nx].czyMina) {
                            licznik++;
                        }
                    }
                    // Zapisujemy liczb min obok
                    plansza[y][x].minyObok = licznik;
                }
            }
        }

        /**
         * Obsuguje kliknicie lewym przyciskiem myszy na pole
         * @param {number} x - Kolumna pola
         * @param {number} y - Wiersz pola
         */
        function klikPole(x, y) {
            // Jeli gra si skoczya lub pole jest odkryte/flaga - koczymy
            if (koniecGry || plansza[y][x].czyOdkryte || plansza[y][x].czyFlaga) return;

            // Jeli to pierwsze kliknicie w grze
            if (pierwszeKlikniecie) {
                rozmiescMiny(x, y); // Rozmieszczamy miny
                pierwszeKlikniecie = false; // To ju偶 nie pierwsze kliknicie
                
                // Uruchamiamy timer
                timer = setInterval(() => {
                    czas++;
                    elementCzas.textContent = czas;
                    
                    // Obsuga trybu na czas
                    if (trybNaCzas) {
                        const pozostalyCzas = limitCzasu - czas;
                        elementLimitCzasu.textContent = `(limit: ${pozostalyCzas}s)`;
                        
                        // Zmiana koloru w zale偶noci od czasu
                        if (pozostalyCzas <= 10) {
                            elementCzas.className = 'czas-krytyczny';
                            elementLimitCzasu.className = 'czas-krytyczny';
                        } else if (pozostalyCzas <= 30) {
                            elementCzas.className = 'czas-ostrzeganie';
                            elementLimitCzasu.className = 'czas-ostrzeganie';
                        } else {
                            elementCzas.className = '';
                            elementLimitCzasu.className = '';
                        }
                        
                        // Sprawdzamy czy czas si skoczy
                        if (czas >= limitCzasu) {
                            koniecGry = true;
                            clearInterval(timer);
                            pokazWszystkieMiny();
                            pokazWynik(false, 'Czas min! Nie udao si odkry wszystkich p贸l w wyznaczonym czasie.');
                        }
                    }
                }, 1000);
            }

            // Odkrywamy pole
            odkryjPole(x, y);

            // Sprawdzamy warunki koca gry
            if (plansza[y][x].czyMina) {
                // Kliknito na min - przegrana
                koniecGry = true;
                clearInterval(timer);
                pokazWszystkieMiny();
                pokazWynik(false, 'Niestety, trafie na min!');
            } else if (odkrytePola === rozmiarPlanszy * rozmiarPlanszy - liczbaMin) {
                // Odkryto wszystkie pola bez min - wygrana
                koniecGry = true;
                clearInterval(timer);
                pokazWynik(true, `Gratulacje! Wygrae w ${czas} sekund!`);
            }

            // Odwie偶amy plansz
            rysujPlansze();
        }

        /**
         * Obsuguje prawy przycisk myszy (flaga)
         * @param {number} x - Kolumna pola
         * @param {number} y - Wiersz pola
         * @returns {boolean} Zawsze false (blokada menu kontekstowego)
         */
        function prawyKlik(x, y) {
            // Jeli gra si skoczya lub pole jest odkryte - koczymy
            if (koniecGry || plansza[y][x].czyOdkryte) return false;

            // Jeli to pierwsze kliknicie w grze
            if (pierwszeKlikniecie) {
                pierwszeKlikniecie = false; // To ju偶 nie pierwsze kliknicie
                
                // Uruchamiamy timer (jak w funkcji klikPole)
                timer = setInterval(() => {
                    czas++;
                    elementCzas.textContent = czas;
                    
                    // Obsuga trybu na czas
                    if (trybNaCzas) {
                        const pozostalyCzas = limitCzasu - czas;
                        elementLimitCzasu.textContent = `(limit: ${pozostalyCzas}s)`;
                        
                        if (pozostalyCzas <= 10) {
                            elementCzas.className = 'czas-krytyczny';
                            elementLimitCzasu.className = 'czas-krytyczny';
                        } else if (pozostalyCzas <= 30) {
                            elementCzas.className = 'czas-ostrzeganie';
                            elementLimitCzasu.className = 'czas-ostrzeganie';
                        } else {
                            elementCzas.className = '';
                            elementLimitCzasu.className = '';
                        }
                        
                        if (czas >= limitCzasu) {
                            koniecGry = true;
                            clearInterval(timer);
                            pokazWszystkieMiny();
                            pokazWynik(false, 'Czas min! Nie udao si odkry wszystkich p贸l w wyznaczonym czasie.');
                        }
                    }
                }, 1000);
            }

            // Sprawdzamy czy mo偶na postawi flag (nie przekroczono limitu)
            if (!plansza[y][x].czyFlaga && liczbaFlag >= limitFlag) {
                pokazWynik(false, 'Wykorzystae wszystkie dostpne flagi!');
                return false;
            }

            // Dodajemy/usuwa flag
            plansza[y][x].czyFlaga = !plansza[y][x].czyFlaga;
            // Aktualizujemy licznik flag
            liczbaFlag += plansza[y][x].czyFlaga ? 1 : -1;
            elementLiczbaFlag.textContent = liczbaFlag;

            // Jeli zostao mao flag - zmieniamy kolor
            if (limitFlag - liczbaFlag <= 3) {
                elementLimitFlag.classList.add('limit-flag');
            } else {
                elementLimitFlag.classList.remove('limit-flag');
            }

            // Sprawdzamy czy wykorzystano wszystkie flagi
            if (liczbaFlag >= limitFlag) {
                koniecGry = true;
                clearInterval(timer);
                pokazWszystkieMiny();
                pokazWynik(false, 'Wykorzystae wszystkie dostpne flagi!');
            }

            // Odwie偶amy plansz
            rysujPlansze();
            return false; // Blokujemy menu kontekstowe
        }

        /**
         * Odkrywa pole na planszy (rekurencyjnie odkrywa puste obszary)
         * @param {number} x - Kolumna pola
         * @param {number} y - Wiersz pola
         */
        function odkryjPole(x, y) {
            // Sprawdzamy czy wsp贸rzdne s poprawne i pole nie jest odkryte/flaga
            if (x < 0 || x >= rozmiarPlanszy || y < 0 || y >= rozmiarPlanszy || 
                plansza[y][x].czyOdkryte || plansza[y][x].czyFlaga) return;

            // Oznaczamy pole jako odkryte
            plansza[y][x].czyOdkryte = true;
            odkrytePola++;

            // Jeli pole jest puste (0 min obok) - odkrywamy ssiad贸w
            if (plansza[y][x].minyObok === 0 && !plansza[y][x].czyMina) {
                const kierunki = [[-1,0], [1,0], [0,-1], [0,1]]; // Tylko 4 kierunki
                for (const [dx, dy] of kierunki) {
                    odkryjPole(x + dx, y + dy); // Rekurencyjne odkrywanie
                }
            }
        }

        /**
         * Pokazuje wszystkie miny na planszy (po przegranej)
         */
        function pokazWszystkieMiny() {
            // Przechodzimy przez wszystkie pola planszy
            for (let y = 0; y < rozmiarPlanszy; y++) {
                for (let x = 0; x < rozmiarPlanszy; x++) {
                    // Jeli pole ma min - odkrywamy je
                    if (plansza[y][x].czyMina) {
                        plansza[y][x].czyOdkryte = true;
                    }
                }
            }
            // Odwie偶amy plansz
            rysujPlansze();
        }

        /**
         * Rysuje aktualny stan planszy w HTML
         */
        function rysujPlansze() {
            const pola = document.querySelectorAll('.pole');
            // Przechodzimy przez wszystkie pola planszy
            for (let y = 0; y < rozmiarPlanszy; y++) {
                for (let x = 0; x < rozmiarPlanszy; x++) {
                    const pole = plansza[y][x];
                    const el = pola[y * rozmiarPlanszy + x];

                    // Resetujemy klasy pola
                    el.className = 'pole';

                    if (pole.czyOdkryte) {
                        // Pole odkryte - pokazujemy zawarto
                        el.classList.add('odkryte');
                        if (pole.czyMina) {
                            // Mina
                            el.textContent = '';
                            el.classList.add('mina');
                        } else if (pole.minyObok > 0) {
                            // Liczba min obok
                            el.textContent = pole.minyObok;
                            el.classList.add(`liczba-${pole.minyObok}`);
                        } else {
                            // Puste pole
                            el.textContent = '';
                        }
                    } else if (pole.czyFlaga) {
                        // Flaga
                        el.classList.add('flaga');
                        el.textContent = '';
                    } else {
                        // Nieodkryte pole
                        el.textContent = '';
                    }
                }
            }
        }

        /**
         * Pokazuje modal z wynikiem gry
         * @param {boolean} wygrana - Czy gracz wygra
         * @param {string} wiadomosc - Wiadomo do wywietlenia
         */
        function pokazWynik(wygrana, wiadomosc) {
            if (wygrana) {
                // Komunikat o wygranej
                emojiWynik.textContent = '';
                emojiWynik.classList.add('win');
                tytulWynik.textContent = 'Gratulacje!';
                if (trybNaCzas) {
                    wiadomosc += `\n(z limitem ${limitCzasu}s)`;
                }
            } else {
                // Komunikat o przegranej
                emojiWynik.textContent = '';
                emojiWynik.classList.add('lose');
                tytulWynik.textContent = 'Przegrana!';
            }
            // Ustawiamy tre i pokazujemy modal
            trescWynik.textContent = wiadomosc;
            modalWynik.style.display = 'flex';
        }
    </script>
    <div class="programisci">
    <br>
    <p>Programici:</p>
    <p>Patryk Reszka</p>
    <p>Micha Parszewski</p>
    <p>Jakub Starzycki</p>
    <p>Adrian Sojka</p>
    <p>Maja Job</p>
    <p>Dawid Szaaski</p>
    </div>
</body>
</html>